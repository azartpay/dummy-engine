<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style/bootstrap.min.css">
    <link rel="stylesheet" href="style/bootstrap-theme.min.css">
    <style>
        .recordData {
            border-bottom: 1px solid #dddddd;
            padding: 10px 0 10px;
            margin-left: 5px;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 60px;
        }

        .data {
            float: left;
            width: 200px;
            margin-left: 20px;
        }

        .deleteBtn {
            float: left;
            width: 100px;
            margin-left: 20px;
        }

    </style>
</head>
<h1 style="text-align: center">玩家桌号编辑</h1>

<div style="margin-top: 100px">
    <div class="input-group">
        <input type="text" class="data" id="playerName" placeholder="playerName">
        <input type="text" class="data" id="tableNumber" placeholder="tableNumber">
        <input type="button" class="btn btn-primary data" value="add" onclick="addPlayer()">
    </div>
    <div id="players">

    </div>
    <div style="margin-left: 20px;">
        <input type="button" class="btn btn-primary" value="save" onclick="saveSetting()">
    </div>
</div>
<script src="js/public/jquery.min.js"></script>
<script type="text/javascript">

    $.post("/getPlayers", {}, function (data) {
        if (data.error_code == 0) {
            var contentDiv = $("#players");
            if (data.players.length <= 0) {
                contentDiv.empty();
                return;
            }
            var recordList = data.players;

            for (var i = 0; i < recordList.length; i++) {
                var item = recordList[i];
                var playerName = item.playerName;
                var tableNumber = item.tableNumber;
                players[playerName] = tableNumber;
                var recordData = $("<div/>", {
                    class: "recordData"
                }).appendTo(contentDiv);
                $("<input/>", {
                    type: "button",
                    class: "btn deleteBtn",
                    value: "delete"
                }).click(function () {
                    $(this).parent().remove();
                }).appendTo(recordData);
                $("<input/>", {
                    type: "text",
                    value: playerName,
                    class: "data",
                    name: "player"
                }).appendTo(recordData);
                $("<input/>", {
                    type: "text",
                    class: "data",
                    value: tableNumber
                }).appendTo(recordData);
            }
        }

    }, "json");

    function saveSetting() {
        var data = [];
        var players = $("#players").find("input[name='player']");
        for (var i = 0; i < players.length; i++) {
            var playerName = $(players[i]).val();
            var tableNumber = $(players[i]).next().val();
            data.push({playerName: playerName, tableNumber: tableNumber});
        }
        $.post("/savePlayers", {players: JSON.stringify(data)}, function (data) {
            if (data.error_code == 0) {
                alert("save success");
            } else {
                alert("save fail");
            }
        });
    }

    function addPlayer() {
        var playerName = $("#playerName").val();
        var tableNumber = $("#tableNumber").val();
        var players = $("#players").find("input[name='player']");
        for (var i = 0; i < players.length; i++) {
            var name = $(players[i]).val();
            players[name] = true;
        }
        if (players[playerName] != undefined) {
            alert("playerName重复");
            return;
        }
        var contentDiv = $("#players");
        var recordData = $("<div/>", {
            class: "recordData"
        }).appendTo(contentDiv);
        $("<input/>", {
            type: "button",
            class: "btn deleteBtn",
            value: "delete"
        }).click(function () {
            $(this).parent().remove();
        }).appendTo(recordData);
        $("<input/>", {
            type: "text",
            value: playerName,
            class: "data",
            name: "player"
        }).appendTo(recordData);
        $("<input/>", {
            type: "text",
            class: "data",
            value: tableNumber
        }).appendTo(recordData);
    }

</script>
<body>

</body>
</html>